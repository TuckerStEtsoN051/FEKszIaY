ROOT := td-redis-operator
TARGETS := operator
REGISTRY := tongduncloud
LDFLAGS := `./hack/version.sh`
	go generate -v ./...

	mkdir _output
	@for target in $(TARGETS); do                                       \
		go build                                                        \
			--ldflags "$(LDFLAGS)"                                      \
			-o ./_output/$${target}                                     \
	done
	rm -rf _output
	mkdir _output
	@for target in $(TARGETS); do                                            \
			-w /go/src/$(ROOT)                                               \
			-v $(PWD):/go/src/$(ROOT)                                        \
			-e GO111MODULE=on                                                \
				./cmd/$${target};                                            \
			-f $(PWD)/build/$${target}/Dockerfile .;                         \

push:
	@for target in $(TARGETS); do                                       \
	done
	@for target in $(TARGETS); do                      \
			VERSION=$(VERSION) envsubst |              \
	done
